"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{4005:function(e,t,r){r.d(t,{L:function(){return et}});var i=r(2265);let o="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",n={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},s={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},l={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},a={b:[16,32,17,15],w:[-16,-32,-17,-15]},h={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},u=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],_=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],f={p:1,n:2,b:4,r:8,q:16,k:32},d=["n","b","r","q"],c={k:s.KSIDE_CASTLE,q:s.QSIDE_CASTLE},p={w:[{square:l.a1,flag:s.QSIDE_CASTLE},{square:l.h1,flag:s.KSIDE_CASTLE}],b:[{square:l.a8,flag:s.QSIDE_CASTLE},{square:l.h8,flag:s.KSIDE_CASTLE}]},m={b:1,w:6},g=["1-0","0-1","1/2-1/2","*"];function b(e){return -1!=="0123456789".indexOf(e)}function v(e){let t=15&e,r=e>>4;return"abcdefgh".substring(t,t+1)+"87654321".substring(r,r+1)}function E(e){return"w"===e?"b":"w"}function C(e,t,r,i,o,n,l=s.NORMAL){let a=i>>4;if("p"===o&&(7===a||0===a))for(let a=0;a<d.length;a++){let h=d[a];e.push({color:t,from:r,to:i,piece:o,captured:n,promotion:h,flags:l|s.PROMOTION})}else e.push({color:t,from:r,to:i,piece:o,captured:n,flags:l})}function k(e){let t=e.charAt(0);if(t>="a"&&t<="h"){if(e.match(/[a-h]\d.*[a-h]\d/))return;return"p"}return"o"===(t=t.toLowerCase())?"k":t}function S(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function y(e){return e.split(" ").slice(0,4).join(" ")}class w{_board=Array(128);_turn="w";_header={};_kings={w:-1,b:-1};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_positionCount={};constructor(e=o){this.load(e)}clear({preserveHeaders:e=!1}={}){this._board=Array(128),this._kings={w:-1,b:-1},this._turn="w",this._castling={w:0,b:0},this._epSquare=-1,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{},this._positionCount={},delete this._header.SetUp,delete this._header.FEN}removeHeader(e){e in this._header&&delete this._header[e]}load(e,{skipValidation:t=!1,preserveHeaders:r=!1}={}){let i=e.split(/\s+/);if(i.length>=2&&i.length<6&&(e=i.concat(["-","-","0","1"].slice(-(6-i.length))).join(" ")),i=e.split(/\s+/),!t){let{ok:t,error:r}=function(e){let t=e.split(/\s+/);if(6!==t.length)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};let r=parseInt(t[5],10);if(isNaN(r)||r<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};let i=parseInt(t[4],10);if(isNaN(i)||i<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};let o=t[0].split("/");if(8!==o.length)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let e=0;e<o.length;e++){let t=0,r=!1;for(let i=0;i<o[e].length;i++)if(b(o[e][i])){if(r)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};t+=parseInt(o[e][i],10),r=!0}else{if(!/^[prnbqkPRNBQK]$/.test(o[e][i]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};t+=1,r=!1}if(8!==t)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if("3"==t[3][1]&&"w"==t[1]||"6"==t[3][1]&&"b"==t[1])return{ok:!1,error:"Invalid FEN: illegal en-passant square"};for(let{color:e,regex:r}of[{color:"white",regex:/K/g},{color:"black",regex:/k/g}]){if(!r.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${e} king`};if((t[0].match(r)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${e} kings`}}return Array.from(o[0]+o[7]).some(e=>"P"===e.toUpperCase())?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}(e);if(!t)throw Error(r)}let o=i[0],n=0;this.clear({preserveHeaders:r});for(let e=0;e<o.length;e++){let t=o.charAt(e);if("/"===t)n+=8;else if(b(t))n+=parseInt(t,10);else{let e=t<"a"?"w":"b";this._put({type:t.toLowerCase(),color:e},v(n)),n++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=s.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=s.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=s.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=s.QSIDE_CASTLE),this._epSquare="-"===i[3]?-1:l[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._updateSetup(e),this._incPositionCount(e)}fen(){let e=0,t="";for(let r=l.a8;r<=l.h1;r++){if(this._board[r]){e>0&&(t+=e,e=0);let{color:i,type:o}=this._board[r];t+="w"===i?o.toUpperCase():o.toLowerCase()}else e++;r+1&136&&(e>0&&(t+=e),r!==l.h1&&(t+="/"),e=0,r+=8)}let r="";this._castling.w&s.KSIDE_CASTLE&&(r+="K"),this._castling.w&s.QSIDE_CASTLE&&(r+="Q"),this._castling.b&s.KSIDE_CASTLE&&(r+="k"),this._castling.b&s.QSIDE_CASTLE&&(r+="q"),r=r||"-";let i="-";if(-1!==this._epSquare){let e=this._epSquare+("w"===this._turn?16:-16);for(let t of[e+1,e-1]){if(136&t)continue;let e=this._turn;if(this._board[t]?.color===e&&this._board[t]?.type==="p"){this._makeMove({color:e,from:t,to:this._epSquare,piece:"p",captured:"p",flags:s.EP_CAPTURE});let r=!this._isKingAttacked(e);if(this._undoMove(),r){i=v(this._epSquare);break}}}}return[t,this._turn,r,i,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==o?(this._header.SetUp="1",this._header.FEN=e):(delete this._header.SetUp,delete this._header.FEN))}reset(){this.load(o)}get(e){return this._board[l[e]]||!1}put({type:e,color:t},r){return!!this._put({type:e,color:t},r)&&(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0)}_put({type:e,color:t},r){if(-1==="pnbrqkPNBRQK".indexOf(e.toLowerCase())||!(r in l))return!1;let i=l[r];if("k"==e&&!(-1==this._kings[t]||this._kings[t]==i))return!1;let o=this._board[i];return o&&"k"===o.type&&(this._kings[o.color]=-1),this._board[i]={type:e,color:t},"k"===e&&(this._kings[t]=i),!0}remove(e){let t=this.get(e);return delete this._board[l[e]],t&&"k"===t.type&&(this._kings[t.color]=-1),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){let e=this._board[l.e1]?.type==="k"&&this._board[l.e1]?.color==="w",t=this._board[l.e8]?.type==="k"&&this._board[l.e8]?.color==="b";e&&this._board[l.a1]?.type==="r"&&this._board[l.a1]?.color==="w"||(this._castling.w&=~s.QSIDE_CASTLE),e&&this._board[l.h1]?.type==="r"&&this._board[l.h1]?.color==="w"||(this._castling.w&=~s.KSIDE_CASTLE),t&&this._board[l.a8]?.type==="r"&&this._board[l.a8]?.color==="b"||(this._castling.b&=~s.QSIDE_CASTLE),t&&this._board[l.h8]?.type==="r"&&this._board[l.h8]?.color==="b"||(this._castling.b&=~s.KSIDE_CASTLE)}_updateEnPassantSquare(){if(-1===this._epSquare)return;let e=this._epSquare+("w"===this._turn?-16:16),t=this._epSquare+("w"===this._turn?16:-16);if(null!==this._board[e]||null!==this._board[this._epSquare]||this._board[t]?.color!==E(this._turn)||this._board[t]?.type!=="p"){this._epSquare=-1;return}[t+1,t-1].some(e=>!(136&e)&&this._board[e]?.color===this._turn&&this._board[e]?.type==="p")||(this._epSquare=-1)}_attacked(e,t){for(let r=l.a8;r<=l.h1;r++){if(136&r){r+=7;continue}if(void 0===this._board[r]||this._board[r].color!==e)continue;let i=this._board[r],o=r-t;if(0===o)continue;let n=o+119;if(u[n]&f[i.type]){if("p"===i.type){if(o>0){if("w"===i.color)return!0}else if("b"===i.color)return!0;continue}if("n"===i.type||"k"===i.type)return!0;let e=_[n],s=r+e,l=!1;for(;s!==t;){if(null!=this._board[s]){l=!0;break}s+=e}if(!l)return!0}}return!1}_isKingAttacked(e){let t=this._kings[e];return -1!==t&&this._attacked(E(e),t)}isAttacked(e,t){return this._attacked(t,l[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&0===this._moves().length}isStalemate(){return!this.isCheck()&&0===this._moves().length}isInsufficientMaterial(){let e={b:0,n:0,r:0,q:0,k:0,p:0},t=[],r=0,i=0;for(let o=l.a8;o<=l.h1;o++){if(i=(i+1)%2,136&o){o+=7;continue}let n=this._board[o];n&&(e[n.type]=n.type in e?e[n.type]+1:1,"b"===n.type&&t.push(i),r++)}if(2===r||3===r&&(1===e.b||1===e.n))return!0;if(r===e.b+2){let e=0,r=t.length;for(let i=0;i<r;i++)e+=t[i];if(0===e||e===r)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this.fen())>=3}isDraw(){return this._halfMoves>=100||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:t,piece:r}={}){let i=this._moves({square:t,piece:r});return e?i.map(e=>this._makePretty(e)):i.map(e=>this._moveToSan(e,i))}_moves({legal:e=!0,piece:t,square:r}={}){let i=r?r.toLowerCase():void 0,o=t?.toLowerCase(),n=[],u=this._turn,_=E(u),f=l.a8,d=l.h1,c=!1;if(i){if(!(i in l))return[];f=d=l[i],c=!0}for(let e=f;e<=d;e++){let t;if(136&e){e+=7;continue}if(!this._board[e]||this._board[e].color===_)continue;let{type:r}=this._board[e];if("p"===r){if(o&&o!==r)continue;t=e+a[u][0],this._board[t]||(C(n,u,e,t,"p"),t=e+a[u][1],m[u]!==e>>4||this._board[t]||C(n,u,e,t,"p",void 0,s.BIG_PAWN));for(let r=2;r<4;r++)136&(t=e+a[u][r])||(this._board[t]?.color===_?C(n,u,e,t,"p",this._board[t].type,s.CAPTURE):t===this._epSquare&&C(n,u,e,t,"p","p",s.EP_CAPTURE))}else{if(o&&o!==r)continue;for(let i=0,o=h[r].length;i<o;i++){let o=h[r][i];for(t=e;!(136&(t+=o));){if(this._board[t]){if(this._board[t].color===u)break;C(n,u,e,t,r,this._board[t].type,s.CAPTURE);break}if(C(n,u,e,t,r),"n"===r||"k"===r)break}}}}if((void 0===o||"k"===o)&&(!c||d===this._kings[u])){if(this._castling[u]&s.KSIDE_CASTLE){let e=this._kings[u],t=e+2;this._board[e+1]||this._board[t]||this._attacked(_,this._kings[u])||this._attacked(_,e+1)||this._attacked(_,t)||C(n,u,this._kings[u],t,"k",void 0,s.KSIDE_CASTLE)}if(this._castling[u]&s.QSIDE_CASTLE){let e=this._kings[u],t=e-2;this._board[e-1]||this._board[e-2]||this._board[e-3]||this._attacked(_,this._kings[u])||this._attacked(_,e-1)||this._attacked(_,t)||C(n,u,this._kings[u],t,"k",void 0,s.QSIDE_CASTLE)}}if(!e||-1===this._kings[u])return n;let p=[];for(let e=0,t=n.length;e<t;e++)this._makeMove(n[e]),this._isKingAttacked(u)||p.push(n[e]),this._undoMove();return p}move(e,{strict:t=!1}={}){let r=null;if("string"==typeof e)r=this._moveFromSan(e,t);else if("object"==typeof e){let t=this._moves();for(let i=0,o=t.length;i<o;i++)if(e.from===v(t[i].from)&&e.to===v(t[i].to)&&(!("promotion"in t[i])||e.promotion===t[i].promotion)){r=t[i];break}}if(!r){if("string"==typeof e)throw Error(`Invalid move: ${e}`);throw Error(`Invalid move: ${JSON.stringify(e)}`)}let i=this._makePretty(r);return this._makeMove(r),this._incPositionCount(i.after),i}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){let t=this._turn,r=E(t);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&s.EP_CAPTURE&&("b"===this._turn?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:t}),"k"===this._board[e.to].type){if(this._kings[t]=e.to,e.flags&s.KSIDE_CASTLE){let t=e.to-1,r=e.to+1;this._board[t]=this._board[r],delete this._board[r]}else if(e.flags&s.QSIDE_CASTLE){let t=e.to+1,r=e.to-2;this._board[t]=this._board[r],delete this._board[r]}this._castling[t]=0}if(this._castling[t]){for(let r=0,i=p[t].length;r<i;r++)if(e.from===p[t][r].square&&this._castling[t]&p[t][r].flag){this._castling[t]^=p[t][r].flag;break}}if(this._castling[r]){for(let t=0,i=p[r].length;t<i;t++)if(e.to===p[r][t].square&&this._castling[r]&p[r][t].flag){this._castling[r]^=p[r][t].flag;break}}e.flags&s.BIG_PAWN?"b"===t?this._epSquare=e.to-16:this._epSquare=e.to+16:this._epSquare=-1,"p"===e.piece?this._halfMoves=0:e.flags&(s.CAPTURE|s.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,"b"===t&&this._moveNumber++,this._turn=r}undo(){let e=this._undoMove();if(e){let t=this._makePretty(e);return this._decPositionCount(t.after),t}return null}_undoMove(){let e=this._history.pop();if(void 0===e)return null;let t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;let r=this._turn,i=E(r);if(this._board[t.from]=this._board[t.to],this._board[t.from].type=t.piece,delete this._board[t.to],t.captured){if(t.flags&s.EP_CAPTURE){let e;e="b"===r?t.to-16:t.to+16,this._board[e]={type:"p",color:i}}else this._board[t.to]={type:t.captured,color:i}}if(t.flags&(s.KSIDE_CASTLE|s.QSIDE_CASTLE)){let e,r;t.flags&s.KSIDE_CASTLE?(e=t.to+1,r=t.to-1):(e=t.to-2,r=t.to+1),this._board[e]=this._board[r],delete this._board[r]}return t}pgn({newline:e="\n",maxWidth:t=0}={}){let r=[],i=!1;for(let t in this._header)r.push("["+t+' "'+this._header[t]+'"]'+e),i=!0;i&&this._history.length&&r.push(e);let o=e=>{let t=this._comments[this.fen()];if(void 0!==t){let r=e.length>0?" ":"";e=`${e}${r}{${t}}`}return e},n=[];for(;this._history.length>0;)n.push(this._undoMove());let s=[],l="";for(0===n.length&&s.push(o(""));n.length>0;){l=o(l);let e=n.pop();if(!e)break;if(this._history.length||"b"!==e.color)"w"===e.color&&(l.length&&s.push(l),l=this._moveNumber+".");else{let e=`${this._moveNumber}. ...`;l=l?`${l} ${e}`:e}l=l+" "+this._moveToSan(e,this._moves({legal:!0})),this._makeMove(e)}if(l.length&&s.push(o(l)),void 0!==this._header.Result&&s.push(this._header.Result),0===t)return r.join("")+s.join(" ");let a=function(){return r.length>0&&" "===r[r.length-1]&&(r.pop(),!0)},h=0;for(let i=0;i<s.length;i++){if(h+s[i].length>t&&s[i].includes("{")){h=function(i,o){for(let n of o.split(" "))if(n){if(i+n.length>t){for(;a();)i--;r.push(e),i=0}r.push(n),i+=n.length,r.push(" "),i++}return a()&&i--,i}(h,s[i]);continue}h+s[i].length>t&&0!==i?(" "===r[r.length-1]&&r.pop(),r.push(e),h=0):0!==i&&(r.push(" "),h++),r.push(s[i]),h+=s[i].length}return r.join("")}header(...e){for(let t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(this._header[e[t]]=e[t+1]);return this._header}loadPgn(e,{strict:t=!1,newlineChar:r="\r?\n"}={}){function i(e){return e.replace(/\\/g,"\\")}e=e.trim();let o=RegExp("^(\\[((?:"+i(r)+")|.)*\\])((?:\\s*"+i(r)+"){2}|(?:\\s*"+i(r)+")*$)").exec(e),n=o&&o.length>=2?o[1]:"";this.reset();let s=function(e){let t={},o=e.split(new RegExp(i(r))),n="",s="";for(let e=0;e<o.length;e++){let r=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;n=o[e].replace(r,"$1"),s=o[e].replace(r,"$2"),n.trim().length>0&&(t[n]=s)}return t}(n),l="";for(let e in s)"fen"===e.toLowerCase()&&(l=s[e]),this.header(e,s[e]);if(t){if("1"===s.SetUp){if(!("FEN"in s))throw Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(s.FEN,{preserveHeaders:!0})}}else l&&this.load(l,{preserveHeaders:!0});let a=function(e){return e=e.replace(RegExp(i(r),"g")," "),`{${Array.from(e.slice(1,e.length-1)).map(function(e){return 128>e.charCodeAt(0)?e.charCodeAt(0).toString(16):encodeURIComponent(e).replace(/%/g,"").toLowerCase()}).join("")}}`},h=e.replace(n,"").replace(RegExp(`({[^}]*})+?|;([^${i(r)}]*)`,"g"),function(e,t,r){return void 0!==t?a(t):" "+a(`{${r.slice(1)}}`)}).replace(RegExp(i(r),"g")," "),u=/(\([^()]+\))+?/g;for(;u.test(h);)h=h.replace(u,"");let _=(h=(h=(h=h.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).trim().split(new RegExp(/\s+/));_=_.filter(e=>""!==e);let f="";for(let e=0;e<_.length;e++){let r=function(e){if(e.startsWith("{")&&e.endsWith("}")){var t;return 0==(t=e.slice(1,e.length-1)).length?"":decodeURIComponent("%"+(t.match(/.{1,2}/g)||[]).join("%"))}}(_[e]);if(void 0!==r){this._comments[this.fen()]=r;continue}let i=this._moveFromSan(_[e],t);if(null==i){if(g.indexOf(_[e])>-1)f=_[e];else throw Error(`Invalid move in PGN: ${_[e]}`)}else f="",this._makeMove(i),this._incPositionCount(this.fen())}f&&Object.keys(this._header).length&&!this._header.Result&&this.header("Result",f)}_moveToSan(e,t){let r="";if(e.flags&s.KSIDE_CASTLE)r="O-O";else if(e.flags&s.QSIDE_CASTLE)r="O-O-O";else{if("p"!==e.piece){let i=function(e,t){let r=e.from,i=e.to,o=e.piece,n=0,s=0,l=0;for(let e=0,a=t.length;e<a;e++){let a=t[e].from,h=t[e].to;o===t[e].piece&&r!==a&&i===h&&(n++,r>>4==a>>4&&s++,(15&r)==(15&a)&&l++)}return n>0?s>0&&l>0?v(r):l>0?v(r).charAt(1):v(r).charAt(0):""}(e,t);r+=e.piece.toUpperCase()+i}e.flags&(s.CAPTURE|s.EP_CAPTURE)&&("p"===e.piece&&(r+=v(e.from)[0]),r+="x"),r+=v(e.to),e.promotion&&(r+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?r+="#":r+="+"),this._undoMove(),r}_moveFromSan(e,t=!1){let r,i,o,n,s;let a=S(e),h=k(a),u=this._moves({legal:!0,piece:h});for(let e=0,t=u.length;e<t;e++)if(a===S(this._moveToSan(u[e],u)))return u[e];if(t)return null;let _=!1;if((i=a.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/))?(r=i[1],o=i[2],n=i[3],s=i[4],1==o.length&&(_=!0)):(i=a.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/))&&(r=i[1],o=i[2],n=i[3],s=i[4],1==o.length&&(_=!0)),h=k(a),u=this._moves({legal:!0,piece:r||h}),!n)return null;for(let e=0,t=u.length;e<t;e++)if(o){if((!r||r.toLowerCase()==u[e].piece)&&l[o]==u[e].from&&l[n]==u[e].to&&(!s||s.toLowerCase()==u[e].promotion))return u[e];if(_){let t=v(u[e].from);if((!r||r.toLowerCase()==u[e].piece)&&l[n]==u[e].to&&(o==t[0]||o==t[1])&&(!s||s.toLowerCase()==u[e].promotion))return u[e]}}else if(a===S(this._moveToSan(u[e],u)).replace("x",""))return u[e];return null}ascii(){let e="   +------------------------+\n";for(let t=l.a8;t<=l.h1;t++){if(0==(15&t)&&(e+=" "+"87654321"[t>>4]+" |"),this._board[t]){let r=this._board[t].type;e+=" "+("w"===this._board[t].color?r.toUpperCase():r.toLowerCase())+" "}else e+=" . ";t+1&136&&(e+="|\n",t+=8)}return e+"   +------------------------+\n     a  b  c  d  e  f  g  h"}perft(e){let t=this._moves({legal:!1}),r=0,i=this._turn;for(let o=0,n=t.length;o<n;o++)this._makeMove(t[o]),!this._isKingAttacked(i)&&(e-1>0?r+=this.perft(e-1):r++),this._undoMove();return r}_makePretty(e){let{color:t,piece:r,from:i,to:o,flags:l,captured:a,promotion:h}=e,u="";for(let e in s)s[e]&l&&(u+=n[e]);let _=v(i),f=v(o),d={color:t,piece:r,from:_,to:f,san:this._moveToSan(e,this._moves({legal:!0})),flags:u,lan:_+f,before:this.fen(),after:""};return this._makeMove(e),d.after=this.fen(),this._undoMove(),a&&(d.captured=a),h&&(d.promotion=h,d.lan+=h),d}turn(){return this._turn}board(){let e=[],t=[];for(let r=l.a8;r<=l.h1;r++)null==this._board[r]?t.push(null):t.push({square:v(r),type:this._board[r].type,color:this._board[r].color}),r+1&136&&(e.push(t),t=[],r+=8);return e}squareColor(e){if(e in l){let t=l[e];return((t>>4)+(15&t))%2==0?"light":"dark"}return null}history({verbose:e=!1}={}){let t=[],r=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){let i=t.pop();if(!i)break;e?r.push(this._makePretty(i)):r.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return r}_getPositionCount(e){let t=y(e);return this._positionCount[t]||0}_incPositionCount(e){let t=y(e);void 0===this._positionCount[t]&&(this._positionCount[t]=0),this._positionCount[t]+=1}_decPositionCount(e){let t=y(e);1===this._positionCount[t]?delete this._positionCount[t]:this._positionCount[t]-=1}_pruneComments(){let e=[],t={},r=e=>{e in this._comments&&(t[e]=this._comments[e])};for(;this._history.length>0;)e.push(this._undoMove());for(r(this.fen());;){let t=e.pop();if(!t)break;this._makeMove(t),r(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){let e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{let t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(let r of["k","q"])void 0!==t[r]&&(t[r]?this._castling[e]|=c[r]:this._castling[e]&=~c[r]);this._updateCastlingRights();let r=this.getCastlingRights(e);return(void 0===t.k||t.k===r.k)&&(void 0===t.q||t.q===r.q)}getCastlingRights(e){return{k:(this._castling[e]&c.k)!=0,q:(this._castling[e]&c.q)!=0}}moveNumber(){return this._moveNumber}}var P=r(2599),I=r(6615),M=e=>{let t=new w;return t.loadPgn(e.pgn()),t},A=(e,t)=>{let r=e.turn(),i=r===t,o=!i,n=e.history().length,s=P.last(e.history({verbose:!0})),l=e.isCheck(),a=e.isCheckmate(),h=e.isDraw(),u=e.isStalemate(),_=e.isThreefoldRepetition(),f=e.isInsufficientMaterial(),d=e.isGameOver();return{turn:r,isPlayerTurn:i,isOpponentTurn:o,moveNumber:n,lastMove:s,isCheck:l,isCheckmate:a,isDraw:h,isStalemate:u,isThreefoldRepetition:_,isInsufficientMaterial:f,isGameOver:d,isDrawn:e.isDraw(),hasPlayerWon:i&&d&&!h,hasPlayerLost:o&&d&&!h}},T=(e,t)=>{try{return M(e).move(t),!0}catch(e){return!1}},q=(e,t)=>{let r=M(e).move(t);return null!==r&&-1!==r.flags.indexOf("p")},N=(e,t)=>e.moves({square:t,verbose:!0}).map(e=>e.to),L=({fen:e,orientation:t}={})=>{let[r,o]=i.useState(new w(e)),[n,s]=i.useState(t??"w");return{game:r,orientation:n,info:A(r,n),methods:{makeMove:e=>{try{let t=M(r);return t.move(e),o(t),!0}catch(e){return!1}},setPosition:(e,t)=>{let r=new w;r.load(e),s(t),o(r)},flipBoard:()=>{s(e=>"w"===e?"b":"w")}}}},R=i.createContext(null),x=()=>{let e=i.useContext(R);if(!e)throw Error("useChessGameContext must be used within a ChessGameProvider");return e},D="rgba(255, 255, 0, 0.5)",O=(e,t,r)=>{let i={},{lastMove:o,isCheck:n}=t;return o&&(i[o.from]={backgroundColor:D},i[o.to]={backgroundColor:D}),r&&(i[r]={backgroundColor:D}),r&&N(e,r).forEach(e=>{i[e]={background:"radial-gradient(circle, rgba(0, 0, 0, 0.1) 25%, transparent 25%"}}),n&&e.board().forEach(e=>e.forEach(e=>{(null==e?void 0:e.type)==="k"&&(null==e?void 0:e.color)===t.turn&&(i[e.square]={backgroundColor:"rgba(255, 0, 0, 0.5)"})})),i},K=({fen:e,orientation:t,children:r})=>{let o=L({fen:e,orientation:t});return i.createElement(R.Provider,{value:o},r)},U=({customSquareStyles:e,...t})=>{let r=x();if(!r)throw Error("ChessGameContext not found");let{game:o,orientation:n,info:s,methods:{makeMove:l}}=r,{turn:a,isGameOver:h}=s,[u,_]=i.useState(null),[f,d]=i.useState(null);return i.createElement(I.r,{customSquareStyles:{...O(o,s,u),...e},boardOrientation:"b"===n?"black":"white",position:o.fen(),showPromotionDialog:!!f,onPromotionPieceSelect:f?e=>{var t;return null==f||!f.from||null==f||!f.to||!e||(d(null),l({from:f.from,to:f.to,promotion:(null==(t=null==e?void 0:e[1])?void 0:t.toLowerCase())||"q"}))}:void 0,onPieceDragBegin:(e,t)=>{_(t)},onPieceDragEnd:()=>{_(null)},onPieceDrop:(e,t,r)=>l({from:e,to:t,promotion:(null==r?void 0:r[1].toLowerCase())||"q"}),onSquareClick:e=>{if(!h){if(null===u){let t=o.get(e);return t&&t.color===a?_(e):void 0}return T(o,{from:u,to:e,promotion:"q"})?q(o,{from:u,to:e,promotion:"q"})?d({from:u,to:e}):void(_(null),l({from:u,to:e})):_(null)}},areArrowsAllowed:!0,animationDuration:0===o.history().length?0:300,...t})},F="rgba(201, 52, 48, 0.5)",z="rgba(172, 206, 89, 0.5)",Q="rgba(27, 172, 166, 0.5)",$=e=>{let t=new w(e.fen);return e.makeFirstMove&&t.move(e.moves[0]),t.turn()},G=e=>i.isValidElement(e),B=(e,t,r,i,o)=>{let n={},s=P.last(i.history({verbose:!0}));return"failed"===e&&s&&(n[s.from]={backgroundColor:F},n[s.to]={backgroundColor:F}),s&&("solved"===e||"failed"!==e&&!r)&&(n[s.from]={backgroundColor:z},n[s.to]={backgroundColor:z}),"piece"===t&&o&&(n[o.from]={backgroundColor:Q}),"move"===t&&o&&(n[o.from]={backgroundColor:Q},n[o.to]={backgroundColor:Q}),n},j=(e,t)=>{let r=new w(e.fen());if(null==t)return null;try{return r.move(t)}catch(e){return null}},H=({puzzle:e})=>({puzzle:e,currentMoveIndex:0,status:"not-started",nextMove:e.moves[0],hint:"none",needCpuMove:!!e.makeFirstMove,isPlayerTurn:!e.makeFirstMove}),W=(e,t)=>{switch(t.type){case"INITIALIZE":return{...e,...H(t.payload)};case"RESET":return{...e,...H({puzzle:e.puzzle})};case"TOGGLE_HINT":if("none"===e.hint)return{...e,hint:"piece"};return{...e,hint:"move"};case"CPU_MOVE":if(e.isPlayerTurn||["solved","failed"].includes(e.status))return e;return{...e,currentMoveIndex:e.currentMoveIndex+1,cpuMove:e.puzzle.moves[e.currentMoveIndex],nextMove:e.currentMoveIndex<e.puzzle.moves.length-1?e.puzzle.moves[e.currentMoveIndex+1]:null,needCpuMove:!1,isPlayerTurn:!0,status:"in-progress"};case"PLAYER_MOVE":{let{move:r,onSolve:i,onFail:o,changePuzzle:n}=t.payload,s=[null==r?void 0:r.san,null==r?void 0:r.lan].includes((null==e?void 0:e.nextMove)||""),l=e.currentMoveIndex===e.puzzle.moves.length-1;if(!s)return o&&o(n),{...e,status:"failed",nextMove:null,hint:"none",isPlayerTurn:!1};if(l)return i&&i(n),{...e,status:"solved",nextMove:null,hint:"none",isPlayerTurn:!1};return{...e,hint:"none",currentMoveIndex:e.currentMoveIndex+1,nextMove:e.puzzle.moves[e.currentMoveIndex+1],status:"in-progress",needCpuMove:!0,isPlayerTurn:!1}}default:return e}},V=(e,t,r)=>{var o;let n=x(),[s,l]=(0,i.useReducer)(W,{puzzle:e},H),{game:a,methods:{makeMove:h,setPosition:u}}=n;(0,i.useEffect)(()=>{n&&a.fen()!==e.fen&&u(e.fen,$(e))},[]);let _=e=>{l({type:"INITIALIZE",payload:{puzzle:e}}),u(e.fen,$(e))};if((0,i.useEffect)(()=>{n&&a.fen()===e.fen&&s.needCpuMove&&setTimeout(()=>l({type:"CPU_MOVE"}),0)},[n,s.needCpuMove]),(0,i.useEffect)(()=>{s.cpuMove&&h(s.cpuMove)},[s.cpuMove]),(0,i.useEffect)(()=>{var i,o,s;(null==(i=null==a?void 0:a.history())?void 0:i.length)<=0+(e.makeFirstMove?1:0)||a.history().length%2!=(e.makeFirstMove?0:1)||(l({type:"PLAYER_MOVE",payload:{move:(null==(s=null==(o=null==n?void 0:n.game)?void 0:o.history({verbose:!0}))?void 0:s.pop())??null,onSolve:t,onFail:r,changePuzzle:_,game:a}}),l({type:"CPU_MOVE"}))},[null==(o=null==a?void 0:a.history())?void 0:o.length]),!n)throw Error("useChessPuzzle must be used within a ChessGameContext");return{status:s.status,changePuzzle:_,puzzle:e,hint:s.hint,onHint:()=>{l({type:"TOGGLE_HINT"})},nextMove:s.nextMove,isPlayerTurn:s.isPlayerTurn}},Z=i.createContext(null),Y=()=>{let e=i.useContext(Z);if(!e)throw Error("useChessGameContext must be used within a ChessGameProvider");return e},J=({puzzle:e,onSolve:t,onFail:r,children:o})=>{let n=V(e,t,r);return i.createElement(Z.Provider,{value:n},o)},X=["failed","solved"],ee=["not-started","in-progress"],et={Root:({puzzle:e,onSolve:t,onFail:r,children:o})=>i.createElement(K,{fen:e.fen,orientation:$(e)},i.createElement(J,{puzzle:e,onSolve:t,onFail:r},o)),Board:({...e})=>{let t=Y(),r=x();if(!t)throw Error("PuzzleContext not found");if(!r)throw Error("ChessGameContext not found");let{game:o}=r,{status:n,hint:s,isPlayerTurn:l,nextMove:a}=t;return i.createElement(U,{customSquareStyles:B(n,s,l,o,j(o,a)),...e})},Reset:({children:e,asChild:t,puzzle:r,onReset:o,showOn:n=X})=>{let s=Y();if(!s)throw Error("PuzzleContext not found");let{changePuzzle:l,status:a}=s,h=()=>{l(r||s.puzzle),null==o||o()};if(!n.includes(a))return null;if(t){let t=i.Children.only(e);if(G(t))return i.cloneElement(t,{onClick:h});throw Error("Change child must be a clickable element")}return i.createElement("button",{type:"button",onClick:h},e)},Hint:({children:e,asChild:t,showOn:r=ee})=>{let o=Y();if(!o)throw Error("PuzzleContext not found");let{onHint:n,status:s}=o,l=()=>{n()};if(!r.includes(s))return null;if(t){let t=i.Children.only(e);if(G(t))return i.cloneElement(t,{onClick:l});throw Error("Change child must be a clickable element")}return i.createElement("button",{type:"button",onClick:l},e)}}}}]);